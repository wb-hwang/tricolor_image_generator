<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>三色重叠图生成器</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <style>
    [v-cloak] {
      display: none
    }

    :root {
      color-scheme: light;
      font-family: "Noto Sans SC", "Segoe UI", sans-serif;
      background: #f5f5f5
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 24px
    }

    .container {
      display: grid;
      grid-template-columns: 360px minmax(360px, 1fr);
      gap: 24px;
      width: 100%;
      max-width: 1200px;
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 12px 32px rgba(0, 0, 0, .08);
      padding: 24px
    }

    .controls {
      display: flex;
      flex-direction: column;
      gap: 16px;
      overflow-y: auto;
      max-height: calc(100vh - 120px);
      padding-right: 8px
    }

    .control-group {
      border: 1px solid #e4e4e7;
      border-radius: 12px;
      padding: 16px
    }

    .control-group h2 {
      margin: 0 0 12px;
      font-size: 16px;
      font-weight: 600;
      color: #111827
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
      color: #374151;
      margin-bottom: 12px
    }

    label:last-of-type {
      margin-bottom: 0
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #d1d5db;
      font-size: 14px
    }

    input[type="color"] {
      height: 36px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      padding: 0;
      overflow: hidden
    }

    .circle-color {
      width: 32px !important;
      height: 32px !important;
      flex-shrink: 0
    }

    input[type="file"] {
      font-size: 13px
    }

    .preset-list {
      display: flex;
      gap: 8px;
      flex-wrap: wrap
    }

    .preset-btn {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      border: 2px solid #fff;
      box-shadow: 0 0 0 1px #d1d5db;
      cursor: pointer;
      padding: 0;
      overflow: hidden;
      display: flex
    }

    .preset-btn span {
      flex: 1;
      height: 100%
    }

    .toggle-group {
      display: flex;
      gap: 12px
    }

    .radio-label {
      display: flex;
      align-items: center;
      gap: 6px;
      margin: 0;
      font-size: 13px;
      cursor: pointer
    }

    .radio-label input {
      width: auto;
      margin: 0
    }

    .canvas-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px
    }

    canvas {
      width: 100%;
      height: auto;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background: linear-gradient(135deg, #f3f4f6, #fff)
    }

    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center
    }

    button {
      padding: 10px 18px;
      border: none;
      border-radius: 999px;
      background: #2563eb;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
      transition: transform .15s, box-shadow .15s
    }

    button:hover {
      transform: translateY(-1px);
      box-shadow: 0 8px 16px rgba(37, 99, 235, .2)
    }

    .config-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding-bottom: 8px;
      margin-bottom: 8px;
      border-bottom: 1px dashed #eee
    }

    .config-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0
    }

    .circle-color {
      width: 32px;
      height: 32px;
      padding: 0;
      flex-shrink: 0
    }

    .alpha-group {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 6px
    }

    .alpha-label {
      font-size: 12px;
      color: #666;
      width: 32px;
      text-align: right
    }

    .text-item {
      margin-bottom: 12px;
      border-bottom: 1px dashed #eee;
      padding-bottom: 12px
    }

    .text-item:last-child {
      border-bottom: none
    }

    .text-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 6px
    }

    .text-label {
      font-weight: 600;
      font-size: 14px;
      color: #111827
    }

    .input-row {
      margin-top: 4px
    }

    .scale-row {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px
    }

    .group-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px
    }

    .group-header h2 {
      margin: 0
    }

    .github-link {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 40px;
      height: 40px;
      background: #24292f;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: transform .2s, box-shadow .2s;
      box-shadow: 0 4px 12px rgba(0, 0, 0, .15)
    }

    .github-link:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 16px rgba(0, 0, 0, .25)
    }

    .github-link svg {
      width: 24px;
      height: 24px;
      fill: #fff
    }

    @media (max-width: 960px) {
      body {
        padding: 16px
      }

      .container {
        grid-template-columns: 1fr
      }

      .controls {
        max-height: unset
      }
    }
  </style>
</head>

<body>
  <a href="https://github.com/wb-hwang/tricolor_image_generator" target="_blank" class="github-link"
    title="View on GitHub">
    <svg viewBox="0 0 16 16">
      <path
        d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z" />
    </svg>
  </a>
  <div id="app">
    <main class="container" v-cloak>
      <section class="controls">
        <div class="control-group">
          <div class="group-header">
            <h2>圆形配置</h2>
            <div class="preset-list">
              <button v-for="(p, i) in presets" :key="i" class="preset-btn" type="button" :title="p.name"
                @click="applyPreset(p.colors)">
                <span v-for="c in p.colors" :style="{background:c}"></span>
              </button>
            </div>
          </div>
          <div v-for="(c, i) in circles" :key="i" class="config-item">
            <div class="text-label">圆 {{ i + 1 }}</div>
            <input type="color" v-model="c.color" class="circle-color" />
            <div class="alpha-group">
              <input type="range" min="0" max="1" step="0.01" v-model.number="c.alpha" style="flex:1;min-width:60px">
              <span class="alpha-label">{{ Math.round(c.alpha * 100) }}%</span>
            </div>
          </div>
        </div>

        <div class="control-group">
          <h2>文本配置</h2>
          <div v-for="(t, k) in texts" :key="k" class="text-item">
            <div class="text-header">
              <div class="text-label">{{ t.label }}</div>
              <div class="toggle-group">
                <label class="radio-label"><input type="radio" :name="'t-'+k" value="text" v-model="t.type"> 文字</label>
                <label class="radio-label"><input type="radio" :name="'t-'+k" value="image" v-model="t.type"> 图片</label>
              </div>
            </div>
            <div class="input-row">
              <div v-if="t.type==='text'" style="display:flex;gap:8px;align-items:center">
                <input type="text" v-model="t.value" placeholder="请输入文本" style="flex:1" />
                <input type="range" min="12" max="100" v-model.number="t.fs" style="width:80px" title="调整字体大小" />
              </div>
              <template v-else>
                <input type="file" accept="image/*" @change="e=>loadImg(k,e)" style="margin-bottom:4px" />
                <div class="scale-row">
                  <span>缩放 {{ t.scale }}x</span>
                  <input type="range" min="0.1" max="5" step="0.1" v-model.number="t.scale" style="flex:1">
                </div>
              </template>
            </div>
          </div>
        </div>

        <div class="control-group">
          <h2>导出设置</h2>
          <label>格式 <select v-model="fmt">
              <option value="png">PNG</option>
              <option value="jpeg">JPEG</option>
              <option value="webp">WebP</option>
            </select></label>
        </div>
      </section>

      <section class="canvas-wrapper">
        <canvas ref="cvs" width="512" height="512"></canvas>
        <div style="width:100%;display:flex;align-items:center;gap:10px;margin-bottom:16px;padding:0 8px">
          <span style="font-size:14px;color:#555;white-space:nowrap">区域大小</span>
          <input type="range" min="50" max="240" v-model.number="mainRadius" style="flex:1" />
        </div>
        <div class="actions">
          <button type="button" @click="reset">重置默认值</button>
          <button type="button" @click="save">导出图片</button>
        </div>
      </section>
    </main>
  </div>

  <script>
    const { createApp, onMounted, reactive, ref, watch } = Vue;
    const SIZE = 512, EXP = 2048;
    const PRESETS = [
      { name: "经典红黄蓝", colors: ["#da3c41", "#efe64d", "#53aedc"] },
      { name: "CMYK风格", colors: ["#00ffff", "#ff00ff", "#ffff00"] },
      { name: "RGB风格", colors: ["#ff0000", "#00ff00", "#0000ff"] },
      { name: "暗黑霓虹", colors: ["#7c3aed", "#10b981", "#f59e0b"] },
      { name: "清新马卡龙", colors: ["#ffb7b2", "#e2f0cb", "#c7ceea"] },
    ];
    const DEF_TEXTS = {
      top: { label: "上方文本", value: "稳定", x: .5, y: .26, fs: 38, fw: 600, fc: "#111827" },
      left: { label: "左下文本", value: "速度", x: .24, y: .7, fs: 38, fw: 600, fc: "#111827" },
      right: { label: "右下文本", value: "便宜", x: .76, y: .7, fs: 38, fw: 600, fc: "#111827" },
      overlapTopLeft: { label: "上左重叠文本", value: "贵", x: .36, y: .5, fs: 32, fw: 600, fc: "#fff" },
      overlapTopRight: { label: "上右重叠文本", value: "慢", x: .64, y: .5, fs: 32, fw: 600, fc: "#fff" },
      overlapBottom: { label: "下方重叠文本", value: "差", x: .5, y: .75, fs: 32, fw: 600, fc: "#fff" },
      center: { label: "中心文本", value: "滚", x: .5, y: .57, fs: 38, fw: 700, fc: "#fff" },
    };
    const initTexts = () => Object.fromEntries(Object.entries(DEF_TEXTS).map(([k, v]) => [k, { ...v, type: "text", img: null, scale: 1 }]));

    createApp({
      setup() {
        const cvs = ref(null);
        const mainRadius = ref(140);
        const circles = reactive([
          { color: "#da3c41", cx: .5, cy: .37, alpha: .7 },
          { color: "#efe64d", cx: .33, cy: .68, alpha: .7 },
          { color: "#53aedc", cx: .67, cy: .68, alpha: .7 },
        ]);
        const texts = reactive(initTexts());
        const fmt = ref("webp");
        const font = '"Noto Sans SC","PingFang SC","Microsoft YaHei",sans-serif';

        const render = (ctx, s) => {
          const sc = s / SIZE;
          ctx.clearRect(0, 0, s, s);
          circles.forEach(c => {
            ctx.save();
            ctx.globalAlpha = c.alpha;
            ctx.fillStyle = c.color;
            ctx.beginPath();
            ctx.arc(c.cx * s, c.cy * s, mainRadius.value * sc, 0, Math.PI * 2);
            ctx.fill();
            ctx.restore();
          });
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          Object.values(texts).forEach(t => {
            if (t.type === "image" && t.img?.complete && t.img.naturalHeight) {
              const base = t.fs * 3 * sc * t.scale, asp = t.img.naturalWidth / t.img.naturalHeight;
              const w = asp > 1 ? base : base * asp, h = asp > 1 ? base / asp : base;
              ctx.drawImage(t.img, t.x * s - w / 2, t.y * s - h / 2, w, h);
            } else if (t.type !== "image" && t.value) {
              ctx.fillStyle = t.fc;
              ctx.font = `${t.fw} ${t.fs * sc}px ${font}`;
              ctx.fillText(t.value, t.x * s, t.y * s);
            }
          });
        };

        const draw = () => { const el = cvs.value; el && render(el.getContext("2d"), SIZE); };
        const loadImg = (k, e) => {
          const f = e.target.files[0]; if (!f) return;
          const r = new FileReader();
          r.onload = ev => { const i = new Image(); i.onload = () => { texts[k].img = i; draw(); }; i.src = ev.target.result; };
          r.readAsDataURL(f);
        };
        const applyPreset = colors => { colors.forEach((c, i) => circles[i] && (circles[i].color = c)); draw(); };
        const reset = () => {
          circles.forEach((c, i) => Object.assign(c, [{ color: "#da3c41", cx: .5, cy: .37, alpha: .7 }, { color: "#efe64d", cx: .33, cy: .68, alpha: .7 }, { color: "#53aedc", cx: .67, cy: .68, alpha: .7 }][i]));
          Object.assign(texts, initTexts());
          mainRadius.value = 140;
          fmt.value = "webp";
          draw();
        };
        const save = () => {
          const c = document.createElement("canvas"); c.width = c.height = EXP;
          render(c.getContext("2d"), EXP);
          const a = document.createElement("a");
          a.download = `tricolor-${new Date().toISOString().replace(/[-:]/g, "").split(".")[0]}.${fmt.value === "jpeg" ? "jpg" : fmt.value}`;
          a.href = c.toDataURL(`image/${fmt.value}`, 1);
          a.click();
        };

        watch([mainRadius, () => circles.map(c => ({ ...c })), () => Object.fromEntries(Object.entries(texts).map(([k, t]) => [k, { value: t.value, type: t.type, scale: t.scale, fs: t.fs }]))], draw, { deep: true, immediate: true });
        onMounted(draw);

        return { cvs, circles, texts, fmt, presets: PRESETS, loadImg, applyPreset, reset, save, mainRadius };
      },
    }).mount("#app");
  </script>
</body>

</html>
